{"ast":null,"code":"var SessionTherapy = require('../models/sessionTherapy.model');\n\nvar Activity = require('../models/activity.model');\n\nvar mongoose = require('mongoose'); //Find all the sessions \n\n\nexports.findAll = function (req, res) {\n  SessionTherapy.find().then(function (sessionTherapy) {\n    res.send(sessionTherapy);\n  })[\"catch\"](function (err) {\n    res.status(500).send({\n      message: err.message\n    });\n  });\n}; //Find all affectiveRelations by a user\n\n\nexports.findByUserSession = function (req, res) {\n  SessionTherapy.find({\n    user: req.params.userId\n  }).populate('user').exec(function (err, sessionTherapy) {\n    if (err) {\n      if (err.kind === 'ObjectId') {\n        return res.status(404).send({\n          message: \"Sessions not found with given user Id \" + req.params.userId\n        });\n      }\n\n      return res.status(500).send({\n        message: \"Error retrieving Sessions not found with given user Id  \" + req.params.userId\n      });\n    }\n\n    res.send(sessionTherapy);\n  });\n};\n\nexports.newActivity = function (req, res) {\n  SessionTherapy.findOne({\n    id: req.params._id\n  }).then(function (sessionTherapy, err) {\n    var newActivity = new Activity({\n      score: req.body.score,\n      sessionTherapy: sessionTherapy._id\n    });\n    newActivity.save(function (err) {\n      if (err) {\n        return res.status(400).send({\n          message: \"Error adding activity \".concat(err)\n        });\n      }\n\n      res.status(200).send(\"\".concat(newActivity));\n    });\n    sessionTherapy.activity.push(newActivity);\n    sessionTherapy.save();\n  })[\"catch\"](function (err) {\n    console.error(err);\n  });\n};","map":null,"metadata":{},"sourceType":"script"}